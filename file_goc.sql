create database QUANLIBANHANG
go

use QUANLIBANHANG
go

create table KHACHHANG(
	MAKH char(4)					CONSTRAINT KHACHHANG_MAKH_PK PRIMARY KEY,
	HOTEN varchar(40)				CONSTRAINT KHACHHANG_HOTEN_NN NOT NULL,
	PHAI nchar(3)					CONSTRAINT KHACHHANG_PHAI_CHK CHECK (PHAI IN (N'NAM',N'NU')),
	DCHI varchar(50)				CONSTRAINT KHACHHANG_DCHI_NN NOT NULL,
	SODT varchar(20)				CONSTRAINT KHACHHANG_SDT_NN NOT NULL,
	NGSINH  smalldatetime			CONSTRAINT KHACHHANG_NGSINH_NN NOT NULL,
	NGDK  smalldatetime				CONSTRAINT KHACHHANG_NGDK_NN NOT NULL,
	DOANHSO money					CONSTRAINT KHACHHANG_DOANHSO_NN NOT NULL

	)
	go

create table NHANVIEN(
	MANV char(4)					CONSTRAINT NHANVIEN_MANV_PK PRIMARY KEY,
	HOTEN varchar(40) 				CONSTRAINT NHANVIEN_HOTEN_NN NOT NULL,
	PHAI nchar(3)					CONSTRAINT NHANVIEN_PHAI_CHK CHECK (PHAI IN (N'NAM',N'NU')),
	NGVL  smalldatetime				CONSTRAINT NHANVIEN_NGVL_NN NOT NULL,
	SODT varchar(20)				CONSTRAINT NHANVIEN_SDT_NN NOT NULL

	)
	go

create table NHACC(
	MANCC char(4)					CONSTRAINT NHACC_MANCC_PK PRIMARY KEY,
	TENNCC varchar(100)				CONSTRAINT NHACC_TENNCC_NN NOT NULL,
	DCHI varchar(50)				CONSTRAINT NHACC_DCHI_NN NOT NULL,
	SODT varchar(20)				CONSTRAINT NHACC_SODT_NN NOT NULL

	)
	go

create table SANPHAM(
	MASP char(4)					CONSTRAINT SANPHAM_MASP_PK PRIMARY KEY,
	TENSP nvarchar(40)				CONSTRAINT SANPHAM_TENSP_NN NOT NULL,
	DVT CHAR(10)					CONSTRAINT SANPHAM_DVT_NN NOT NULL,
	HANSD smalldatetime				CONSTRAINT SANPHAM_HANSD_NN NOT NULL,
	NHCC char(4)					CONSTRAINT SANPHAM_NHCC_FK FOREIGN KEY (NHCC) REFERENCES NHACC(MANCC),
	GIA money						CONSTRAINT SANPHAM_GIA_NN NOT NULL

	)
	go

create table HOADON(
	SOHD int 						CONSTRAINT HOADON_SOHD_PK PRIMARY KEY,
	NGHD  smalldatetime				CONSTRAINT HOADON_NGHD_NN NOT NULL,
	MAKH char(4)					CONSTRAINT HOADON_MAKH_FK FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
	MANV char(4)					CONSTRAINT HOADON_MANV_FK FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
	TRIGIA money					

	)
	go

create table CTHD(
	SOHD int					CONSTRAINT CTHD_SOHD_FK FOREIGN KEY (SOHD) REFERENCES HOADON(SOHD),
	MASP char(4)				CONSTRAINT CTHD_MASP_FK FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP),
	SL int						CONSTRAINT CTHD_SL_NN NOT NULL,

	CONSTRAINT PK_CTHD PRIMARY KEY (SOHD,MASP)
	)
	go

	ALTER TABLE SANPHAM ADD CONSTRAINT CHECK_GIA CHECK(GIA>=500)
	

	--INSERT * FROM KHACHHANG

	INSERT INTO KHACHHANG (MAKH,HOTEN,PHAI,DCHI,SODT,NGSINH,NGDK,DOANHSO) VALUES
	('KH01','NGUYEN TUAN HUNG',N'NAM','230 TRUNG VUONG, HA NOI','0903657826',2002/04/12,2020/03/13, 2000000),
	('KH02','HO HUY PHUC',N'NAM','735 TRAN HUNG DAO, Q1, TP HCM','0907579875',2000/07/08,2021/07/17, 3000000),
	('KH03','TRAN HOANG LUAN',N'NAM','173 HO VAN HUE, QPHU NHUAN, TP HCM','857658790',2001/05/23,2021/06/21, 2500000),
	('KH04','TRAN NGOC LINH',N'NU','456 LE HONG PHONG, Q10, TP HCM','0340240540',2000/07/30,2020/04/01, 4000000),
	('KH05','PHAM ANH KHANH',N'NAM','956 AU CO, P14, QTAN BINH, TP HCM','0705674778',1999/09/14,2021/02/09, 1300000),
	('KH06','LE QUOC VIET',N'NAM','579 DUONG BA TRAC, P1, Q8, TP HCM','0369067890',1998/09/06,2021/04/14, 10000000),
	('KH07','NGUYEN HONG VAN',N'NU','457B LE DAI HANH, P11, Q11, TP HCM','0704067987',1996/11/21,2020/06/29, 13000000)


	--INSERT * FROM NHANVIEN
	INSERT INTO NHANVIEN (MANV,HOTEN,PHAI,NGVL,SODT) VALUES
	('NV01','NGUYEN CONG PHU',N'NAM',2020/11/20,'0705789870'),
	('NV02','TRAN THI NHAN',N'NU',2021/07/15,'0905788976'),
	('NV03','NGUYEN HUY HOANG',N'NAM',2019/08/11,'0902340987'),
	('NV04','PHAM THANH TRUC',N'NU',2020/02/11,'0343679872'),
	('NV05','NGUYEN CAM HUONG',N'NU',2021/06/21,'0367869860'),
	('NV06','TRAN THANH CONG',N'NAM',2020/09/11,'0704560987'),
	('NV07','PHAM VUONG DAO',N'NAM',2021/03/01,'0904444098')


	
	--INSERT * FROM NHACC
	INSERT INTO NHACC (MANCC,TENNCC,DCHI,SODT) VALUES
	('CC01','CONG TU TNHH NUOC GIAI KHAC SUNTORY PEPSICO VIENAM','88 DONG KHOI, P.BEN NGHE, Q1, TP HCM','02838219437'),
	('CC02','CONG TY CO PHAN ACECOOK VIET NAM','KCN TAN BINH, P.TAY THANH, Q. TAN PHU, TP HCM','02838154064'),
	('CC03','CONG TY TNHH NUOC GIAI KHAC COCA-COLA VIET NAM','485 XA LO HA NOI, P.LINH TRUNG, THU DUC, TP HCM','02838961000'),
	('CC04','CONG TY CO PHAN CHAN NUOI C.P VIET NAM','KCN2, TP BIEN HOA, DONG NAI','02513836251'),
	('CC05','CONG TY CO PHAN SAI GON FOOD','VINH LOC A, BINH CHANH, TP HCM','02873004456')

	
	--INSERT * FROM SANPHAM
	INSERT INTO SANPHAM (MASP,TENSP,DVT,HANSD,NHCC,GIA) VALUES
	('SP01','  NUOC NGOC COCACOLA','CHAI',2022/12/30,'CC03',10000),
	('SP02','  NUOC NGOC PEPSI','CHAI',2022/09/30,'CC01',10000),
	('SP03','  MI LY MODERN','LY',2022/06/30,'CC02',8000),
	('SP04','  SUON NON HEO CP','KG',2022/01/30,'CC04',90000),
	('SP05','  BIT XUC XICH GOLD TIET TRUNG','GOI',2022/03/30,'CC04',30000),
	('SP06','  COM CHIEN CHAY GAO LUC','HOP',2022/03/30,'CC05',40000),
	('SP07','  NUOC UONG TANG LUC STING','CHAI',2022/12/30,'CC01',12000)

	--INSERT * FROM HOADON
	INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES
	(15001,2021/09/27,'KH01','NV04',100000),
	(15002,2021/11/30,'KH03','NV05',12000),
	(15003,2021/10/28,'KH07','NV01',1000000),
	(15004,2021/11/21,'KH05','NV01',140000),
	(15005,2021/10/30,'KH02','NV07',200000),
	(15006,2021/11/23,'KH04','NV03',330000)



	--INSERT * FROM CTHD
	INSERT INTO CTHD (SOHD,MASP,SL) VALUES
	(15001,'SP04',1),
	(15001,'SP01',1),
	(15003,'SP04',6),
	(15003,'SP01',6),
	(15003,'SP07',10),
	(15003,'SP05',10),
	(15006,'SP05',2),
	(15006,'SP04',3),
	(15002,'SP07',1)

